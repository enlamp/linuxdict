install
cdrom
lang en_US.UTF-8
keyboard us
network --device eth0 --bootproto static --hostname ibm012 --ip 192.168.1.102 --netmask 255.255.255.0 --gateway 192.168.1.1 --nameserver 192.168.1.1
firewall --enabled eth0 --ssh --http --port=https:tcp
rootpw  123456
selinux --disabled
timezone Asia/Shanghai

bootloader --location=mbr --driveorder=sda
firstboot --disable
reboot

# Partitioning
clearpart --all --initlabel --drives=sda
part /boot --fstype ext3 --size=200 --ondisk=sda
part pv.2 --size=0 --grow --ondisk=sda
volgroup sys --pesize=32768 pv.2
logvol / --fstype ext3 --name=root --vgname=sys --size=1 --grow
logvol swap --fstype swap --name=swap --vgname=sys --size=2048

%packages
@core
yum

%post
# [ svc-off ]
# Disable not server related services
chkconfig acpid off
chkconfig apmd off
chkconfig auditd off
chkconfig bluetooth off
chkconfig cpuspeed off
chkconfig cups off
chkconfig firstboot off
chkconfig gpm off 
chkconfig ip6tables off
chkconfig kudzu off
chkconfig nfslock off
chkconfig pcscd off
chkconfig portmap off
chkconfig rpcgssd off
chkconfig rpcidmapd off
chkconfig sendmail off
chkconfig smartd off
chkconfig yum-updatesd off
chkconfig avahi-daemon off
chkconfig hidd off

# [ ipv6-off ]
# Disable IPV6
echo "alias net-pf-10 off" >> /etc/modprobe.conf

# [ autofsck ]
# Enable autofsck on boot
echo "AUTOFSCK_TIMEOUT=5" > /etc/sysconfig/autofsck
echo "AUTOFSCK_DEF_CHECK=yes" >> /etc/sysconfig/autofsck

# [ ssh-enable-root-nopw ]
cat /etc/ssh/sshd_config | grep -vE "^[ \t]*PermitRootLogin" > /tmp/sshd_config.ssh-enable-root
cat /tmp/sshd_config.ssh-enable-root > /etc/ssh/sshd_config
echo "PermitRootLogin without-password" >> /etc/ssh/sshd_config

# [ yum-update ]
echo "yum -y update" | at now + 5 min


